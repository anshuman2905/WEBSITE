<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Farm Field Planner</title>
  <link rel="icon" type="image/png" href="Screenshot_2025-08-29_092552-removebg-preview.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #fieldLayout {
      display: grid;
      grid-template-columns: repeat(100, 1fr); /* 100 total slots */
      grid-template-rows: 1fr;
      gap: 6px;
      height: 200px;
    }
  </style>
</head>
<body class="bg-green-50 min-h-screen flex items-center justify-center">

  <div class="w-full max-w-5xl p-6">
    <h1 class="text-3xl font-bold text-center text-green-700 mb-6">🌾 Farm Field Planner</h1>

    <!-- Clear Button -->
    <div class="flex justify-end mb-4">
      <a href="crops.html" id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded inline-block text-center">
        Clear
      </a>
    </div>

    <!-- Field Layout -->
    <div id="fieldLayout" class="border p-2 rounded-xl bg-white"></div>
  </div>

  <!-- Add Crop Button -->
  <button id="addBtn"
    class="fixed bottom-6 right-6 bg-green-600 text-white w-14 h-14 rounded-full shadow-lg hover:bg-green-700 text-3xl flex items-center justify-center">
    +
  </button>

  <!-- Modal for adding crop -->
  <div id="formModal" class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center">
    <div class="bg-white rounded-2xl shadow-lg p-6 w-96">
      <h2 class="text-xl font-semibold mb-4">Add Crop</h2>
      <form id="cropForm" class="space-y-4">
        <div>
          <label class="block text-sm font-medium">Select Crop</label>
          <select id="cropName" required class="w-full border rounded-lg p-2">
            <option value="">-- Choose --</option>
            <option value="Corn">Corn 🌽</option>
            <option value="Wheat">Wheat 🌾</option>
            <option value="Bajra">Bajra 🌱</option>
            <option value="Rice">Rice 🍚</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium">Area (max 100)</label>
          <input type="number" id="cropArea" min="1" max="100" required class="w-full border rounded-lg p-2" />
        </div>
        <div class="flex justify-end space-x-2">
          <button type="button" id="cancelBtn" class="px-4 py-2 rounded-lg border">Cancel</button>
          <button type="submit" class="px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700">Save</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const addBtn = document.getElementById('addBtn');
    const formModal = document.getElementById('formModal');
    const cancelBtn = document.getElementById('cancelBtn');
    const cropForm = document.getElementById('cropForm');
    const fieldLayout = document.getElementById('fieldLayout');
    const logoutBtn = document.getElementById('logoutBtn');

    let crops = [];
    let serial = 1;
    const totalArea = 100; // match grid columns (symmetry)

    // Load saved crops
    const savedCrops = localStorage.getItem('crops');
    if (savedCrops) {
      crops = JSON.parse(savedCrops);
      if (crops.length > 0) {
        serial = Math.max(...crops.map(c => c.id)) + 1;
      }
      renderFields();
    }

    // Open / close modal
    addBtn.onclick = () => formModal.classList.remove('hidden');
    cancelBtn.onclick = () => formModal.classList.add('hidden');

    // Handle crop form
    cropForm.onsubmit = (e) => {
      e.preventDefault();
      const cropName = document.getElementById('cropName').value;
      const cropArea = parseInt(document.getElementById('cropArea').value);

      if (!cropName || cropArea <= 0) {
        alert("Please enter valid crop details.");
        return;
      }

      const usedArea = crops.reduce((sum, c) => sum + c.area, 0);
      if (usedArea + cropArea > totalArea) {
        alert("Not enough land left! Available: " + (totalArea - usedArea));
        return;
      }

      const newCrop = { id: serial++, name: cropName, area: cropArea };
      crops.push(newCrop);

      localStorage.setItem('crops', JSON.stringify(crops));

      renderFields();
      cropForm.reset();
      formModal.classList.add('hidden');
    };
    function renderFields() {
      fieldLayout.innerHTML = '';
      crops.forEach(crop => {
        const div = document.createElement('div');
        div.className =
          "rounded-xl shadow-md flex items-center justify-center text-lg font-semibold cursor-pointer transition bg-green-100 border border-green-300";
        div.innerText = crop.name;
        div.style.gridColumn = `span ${crop.area}`;

        div.onclick = () => {
          window.location.href = `${crop.name}start.html?name=${encodeURIComponent(crop.name)}&area=${crop.area}&id=${crop.id}`;
        };

        fieldLayout.appendChild(div);
      });
    }

    logoutBtn.onclick = () => {
      localStorage.removeItem('crops');
      crops = [];
      renderFields();
    };
  </script>
</body>
</html>
